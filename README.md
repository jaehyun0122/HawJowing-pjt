# í•´ì¤˜ì‰(HawJowing)

ì—¬ëŸ¬ ê³ ë¯¼ë“¤ì„ ë‹¤ë¥¸ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ„ê³  ê²°ì •ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆëŠ” SNS ì…ë‹ˆë‹¤.

- ê°œë°œ ê¸°ê°„ : 22/01/3 ~ 22/02/18
- íŒ€ëª… : ì›Œë¼ë²¨

![img](https://lh4.googleusercontent.com/oPums7AlHUAoK6ajOFOygc62xgh6lRZrGzsUsoixM0djSyu6Mo_fcWgYrVSYKzf6wcozV321rSlhQkBHPVjxWuGwuOEWBAi7sjlDdhszng2PubQYSITbpp_vfRpR4UgYii6JSNIYqJRw)

---

### ğŸŒ‰ê°œë°œë°°ê²½

ì ì‹¬ì— ë­ë¨¹ì„ì§€, ì—¬í–‰ì€ ì–´ë””ë¡œ ê°ˆì§€ ë“± ì—¬ëŸ¬ ê³ ë¯¼ë“¤ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ ê³ ë¯¼ë“¤ì„ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ë‚˜ëˆ„ê³  ì˜ê²¬ì„ ë°›ê±°ë‚˜ ì¤„ ìˆ˜ ìˆëŠ” ëª¨ë°”ì¼ì›¹ SNSë¥¼ ê°œë°œí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

---

### íŒ€ì› ë° ì—­í• 

#### Front 

> ê¸°ìˆ  ìŠ¤íƒ
>
> > React, node.js

- ì±„ì„±ì›

- í—ˆì˜ë¯¼

- ì •ì •ì±„

#### Back 

> ê¸°ìˆ  ìŠ¤íƒ
>
> > Spring boot, docker

- ì •ì¬í˜„
- í•œìœ¤í¬
- ì´ì€ì„±

# Process

![image](/uploads/1bca25d088e1606376695e2084a14fad/image.png)



# ê¸°íš

## í”„ë¡œì íŠ¸ ê¸°íš

<ul>
  <li>E-R Diagram</li>
  <p align="center">
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/ERD.png?raw=true" />
  </p>
  <li>Wireframe</li>
  <p align="center">
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/wireframe.png?raw=true" />
  </p>
  <li>Swagger API Document</li>
  <p align="center">
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/1.PNG?raw=true" />
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/2.PNG?raw=true" />
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/3.PNG?raw=true" />
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/5.PNG?raw=true" />
    <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/6.PNG?raw=true" />
  </p>
</ul>

## ë¹Œë“œ ë° ë°°í¬
<ul>
  <li>
    <b>ì‚¬ìš©í•œ JVM, ì›¹ì„œë²„, WAS ì œí’ˆ  ë“±ì˜ ì¢…ë¥˜ì™€ ì„¤ì •ê°’, ë²„ì „(IDE ë²„ì „ í¬í•¨)</b>
    <ul>
      <li>JVM : Java 11</li>
      <li>í†µí•©ê°œë°œí™˜ê²½(IDE) : ì¸í…”ë¦¬ì œì´ 3.1 (Back-end), VSCode 1.63.2 (Front-end)</li>
      <li>ì›¹ì„œë²„ : ë¡œì»¬(http://localhost:8080, http://i6c103.p.ssafy.io)</li>
      <li>WAS : SpringBoot ë‚´ì¥ í†°ìº£</li>
    </ul>
  </li>
  <li>
    <b>ë°°í¬ ì•„í‚¤í…ì³</b>
    <p align="center">
      <img width="800px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/%EC%8B%9C%EC%8A%A4%ED%85%9C%20%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98.png?raw=true" />
    </p>
  </li>
  <li>
    <b>í¬íŠ¸ ë²ˆí˜¸</b>
    <p>[Front-end] : 3000</p>
    <p>[Back-end] : 8080</p>
    <p>[Database] : 3306</p>
â€‹    <b>Version</b>
    <ul>
      <li>[Front-end] : eact 17.0.2 , react-bootstrap 2.1.1, style-component 5.3.3 , web-vitals 2.1.3</li>
      <li>[Back-end] : ì›¹ì„œë²„ : SpringBoot 2.5.9, Java : 11.0.13, jwt auth, Spring Security</li>
      <li>[Database] : mybatis 2.2.1 mysql 8.0.28</li>
      <li>[OS, Server] : Ubuntu 20.04, Nginx 1.18.0, AWS S3
    </ul>
  </li>
  <li>
    <p>Nginx</p>
    <p>nginx ì„¤ì •(/etc/nginx/siteds-enabled/default</p>
    <p align="center">
      <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/Nginx.PNG?raw=true" />
    </p>
  </li>
  <li>
    <b>ì„œë²„ ì„¸íŒ…</b>
    <p align="center">
      <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/%EC%84%9C%EB%B2%84%EC%84%B8%ED%8C%85.PNG?raw=true" />
    </p>
  </li>
  <li>
    <b>Front-end</b>

    <p align="center">
      <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/%ED%94%84%EB%A1%A0%ED%8A%B8.PNG?raw=true" />
    </p>

â€‹    <b>Back-end</b>

    <p align="center">
      <img width="600px", src="https://github.com/swchae516/SSAFY_6th_Sub_PJT/blob/main/%EB%B0%B1.PNG?raw=true" />
    </p>


# Front-End

### React ê¸°ë°˜ ê°œë°œ

- CSS module ê³¼ Styled Componentë¥¼ ì‚¬ìš©í•˜ì—¬ ê°ì ìŠ¤íƒ€ì¼ëŒ€ë¡œ CSS ì»´í¬ë„ŒíŠ¸ êµ¬ì„±

  ![image-20220128104703524](./README.assets/image-20220128104703524.png)

  ![image-20220128104732468](./README.assets/image-20220128104732468.png)

  

- React-redux ë¥¼ ì‚¬ìš©í•˜ì—¬ Alarm ë°ì´í„°ë¥¼ ì €ì¥ ë° ì‚¬ìš©ì„í•˜ê³  ì¶”í›„ì— ë” ë‹¤ì–‘í•œ ê³³ì— ì‚¬ìš©í•  ì˜ˆì •

![image-20220128104853468](./README.assets/image-20220128104853468.png)

![image-20220128104953731](./README.assets/image-20220128104953731.png)



- Component ê°„ì— Props ë¥¼ ì´ìš©í•˜ì—¬ Component ì¬ì‚¬ìš©ì„±ì„ ëŠ˜ë¦¼

![image-20220128105118271](./README.assets/image-20220128105118271.png)

- React-router-dom ìœ¼ë¡œ í˜ì´ì§€ë¥¼ êµ¬ì„±. ì¶”í›„ì— Next.js ë¥¼ í•™ìŠµí•˜ë©´ ì ìš©í•  ìˆ˜ë„ ìˆìŒ

![image-20220128105142115](./README.assets/image-20220128105142115.png)

- React Hook ì„ ì´ìš©í•˜ì—¬ CRUD, Infinite Scrollë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„

![image-20220128105202459](./README.assets/image-20220128105202459.png)

![image-20220128105235485](./README.assets/image-20220128105235485.png)

- ì†Œì…œë¡œê·¸ì¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•˜ì—¬ OAuthë¥¼ í†µí•œ ì†Œì…œë¡œê·¸ì¸ êµ¬í˜„

  ![image-20220128105300669](./README.assets/image-20220128105300669.png)

  ![image-20220128105318231](./README.assets/image-20220128105318231.png)

  ![image-20220128105331270](./README.assets/image-20220128105331270.png)

![image-20220128105344039](./README.assets/image-20220128105344039.png)



# Back-End

- Spring boot ê¸°ë°˜ ê°œë°œ

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```tex
src
	-main/java/come.haejwoing.back
		-config
			-jwt
				-JwtAuthorizationFilter
				-JwtProperties
				-PrincipalDetails
				-PrincipalDetailsService
            -CorsConfig
            -SecurityConfig
        -controller
        	-*Controller
        -model
        	-dto
        	-mapper
        	-service
        BackApplication
    -resource
    	-mappers
    		-*.xml
    	-application.yml
	
```



## JWT

```java
public class JwtAuthorizationFilter extends BasicAuthenticationFilter {

	private UserService userService;

	public JwtAuthorizationFilter(AuthenticationManager authenticationManager, UserService userService) {
		super(authenticationManager);
		this.userService = userService;
	}

	@Override
	protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain chain)
			throws IOException, ServletException {

		String header = request.getHeader(JwtProperties.HEADER_STRING);
		System.out.println("header Authorization : " + header);

		if (header == null || !header.startsWith(JwtProperties.TOKEN_PREFIX)) {
			chain.doFilter(request, response);
			return;
		}
		String token = request.getHeader(JwtProperties.HEADER_STRING).replace(JwtProperties.TOKEN_PREFIX, "");

		// í† í° ê²€ì¦ (ì´ê²Œ ì¸ì¦ì´ê¸° ë•Œë¬¸ì— AuthenticationManagerë„ í•„ìš” ì—†ìŒ)
		// ë‚´ê°€ SecurityContextì— ì§‘ì ì ‘ê·¼í•´ì„œ ì„¸ì…˜ì„ ë§Œë“¤ë•Œ ìë™ìœ¼ë¡œ UserDetailsServiceì— ìˆëŠ”
		// loadByUsernameì´ í˜¸ì¶œë¨.
		String nickname = JWT.require(Algorithm.HMAC512(JwtProperties.SECRET)).build().verify(token)
				.getClaim("nickname").asString();
		System.out.println("token : "+nickname);
```



## Controller

```java
@RestController
@RequestMapping("/jwt")
public class JwtController {

    @Autowired
    private UserServiceImpl userServiceImpl;

    @PostMapping("/google")
    public ResponseEntity<Map<String, Object>> isGoogleUser(@RequestBody Map<String, Object> data){
        GoogleUser googleUser = new GoogleUser((Map<String, Object>) data.get("profileObj"));
        log.info("data : {}", data);
        log.info("profileObj : {}", data.get("profileObj"));
        User userEntity = userServiceImpl.searchByEmail(googleUser.getEmail());

        if(userEntity == null) {
            log.info("êµ¬ê¸€ ë¡œê·¸ì¸ ì²« ë°©ë¬¸");
            Map<String, Object> map = new HashMap<>();
            map.put("check", false);
            map.put("email", googleUser.getEmail());
            log.info(map.toString());
            return new ResponseEntity<>(map, HttpStatus.OK);

        } else if(userEntity.getUserStatus() == 0){ // íšŒì› íƒˆí‡´í•œ ê¸°ë¡ì´ ìˆëŠ” ìœ„ì €ê°€ ë“¤ì–´ì˜¤ë©´ ë‹¤ì‹œ íšŒì›ê°€ì…í•´ì¤˜ì•¼í•¨
            log.info("êµ¬ê¸€ íƒˆí‡´ í–ˆë˜ íšŒì›");
            Map<String, Object> map = new HashMap<>();
            map.put("check", false);
            map.put("email", googleUser.getEmail());
            log.info(map.toString());
            return new ResponseEntity<>(map, HttpStatus.OK);

        } else if(userEntity.getUserStatus() == 1) {
            log.info("êµ¬ê¸€ íšŒì›ê°€ì… ì™„ë£Œ íšŒì› ");
            User userRequest = User.builder()
                    .email(userEntity.getEmail())
                    .nickname(userEntity.getNickname())
                    .role("ROLE_USER")
                    .image(userEntity.getImage())
                    .userStatus(1)
                    .build();

            String jwtToken = new JwtProvider().createJwtToken(userRequest);
            Map<String, Object> map = new HashMap<>();
            map.put("check", true);
            map.put("id", userServiceImpl.getUserId(userEntity.getEmail()));
            map.put("jwtToken", jwtToken);
            log.info("id : {}", map.get("jwtToken"));

            return new ResponseEntity<>(map, HttpStatus.OK);
        }
        else return new ResponseEntity<>(HttpStatus.NO_CONTENT);
    }

```



## Model

### Dto

```java
@Data
@Builder
public class User {

    private int id;
    private String email;
    private String nickname;
    private int gender;
    private String birth;
    private String image;
    private String role;
    private int userStatus;
    private double point;

    public List<String> getRoleList(){
        if(this.role.length() > 0){
            return Arrays.asList(this.role.split(","));
        }
        return new ArrayList<>();
    }
}
```

### Mapper

```java
@Mapper
public interface UserMapper {

    void insertUser(User user);
    User searchByEmail(String email);
    List<User> listAllUser();
    void withdrawUser(int id);
    void setPoint(Map<String, Object> map);
    List<User> listFollower(int id);
    List<User> listFollow(int id);
    int getUserId(String email);
    User userInfo(int id);
    void updateProfile(User user);
    int checkNickname(String nickname);
    int addFollow(int id, int toUser);
    int checkFollow(int id, int loginedId);
    int unFollow(int toUser, int fromUser);
    List<User> findByNickname(String nickname);
    List<Map<String, Object>> getFollowerId(int id);
    double getPercentage(int id);
    User getUserByNickname(String nickname);
    void updateByEmail(Map<String, Object> userMap);
}
```

### Service

```java
public interface UserService {

    void insertUser(User user);
    List<User> listAllUser();
    User searchByEmail(String email);
    void withdrawUser(int id);
    void setPoint(Map<String, Object> map);
    List<User> listFollower(int id);
    List<User> listFollow(int id);
    int getUserId(String email);
    User searchById(int id);
    void updateProfile(User user);
    Boolean checkNickname(String nickname);
    Boolean addFollow(int id, int toUser);
    Boolean checkFollow(int id, int loginedId);
    Boolean unFollow(int toUser, int fromUser);
    List<User> findByNickname(String nickname);
    List<Map<String, Object>> getfollowerId(int id);
    double getPercentage(int id);
    User getUserByNickname(String nickname);
    void updateByEmail(Map<String, Object> userMap);
}
```



## Resources

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haejwoing.back.model.mapper.UserMapper">

    <insert id="insertUser" parameterType="User">
        insert into user(nickname, email, gender, role, birth, user_status, point, image)
        values (#{nickname}, #{email}, #{gender}, #{role}, #{birth}, #{userStatus}, #{point}, #{image})
    </insert>

    <update id="setPoint" parameterType="map">
        update user
        set point= point + #{score}
        where id=#{userId}
    </update>

    <select id="searchByEmail" parameterType="String" resultType="User">
        select * from user
        where email = #{email}
    </select>

    <select id="listAllUser" resultType="map">
        select nickname, email, gender, birth, image, role
        from user
    </select>

    <update id="withdrawUser" parameterType="int">
        update user
        set user_status = 0
        where id=#{id}

    </update>
```



### Properties

- application.yml

```properties
server:
  port: 8080

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    
mybatis:
  type-aliases-package: com.haejwoing.back.model.dto
  mapper-locations: classpath:mappers/*.xml
```

